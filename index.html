<!DOCTYPE html>
<html>
<head>
    <title>Brain Busters Math Admin</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f0f4f8; display: flex; gap: 20px; }
        .column { flex: 1; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-left: 5px solid #3498db; padding-left: 15px; margin-bottom: 20px; }
        input, select, textarea { width: 100%; margin: 8px 0; padding: 12px; border: 1px solid #d1d9e6; border-radius: 6px; box-sizing: border-box; }
        button { background: #3498db; color: white; border: none; padding: 14px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; }
        .top-score { background: rgba(241, 196, 15, 0.15) !important; font-weight: bold; border-left: 4px solid #f1c40f; }
    </style>
</head>
<body>
    <div class="column">
        <h1>üî¢ Curriculum</h1>
        <div class="card">
            <h3>Add Kindergarten Quiz</h3>
            <select id="math-topic">
                <option value="Addition">Addition ‚ûï</option>
                <option value="Subtraction">Subtraction ‚ûñ</option>
            </select>
            <select id="quiz-difficulty">
                <option value="Easy">Easy (0-5) üü¢</option>
                <option value="Hard">Hard (0-10) üî¥</option>
            </select>
            <input type="text" id="sub-concept" placeholder="Concept Name (e.g., Adding 1s)">
            <input type="text" id="question" placeholder="Question (e.g., 2 + 1 = ?)">
            <input type="text" id="answer" placeholder="Correct Answer">
            <div style="display: flex; gap: 5px;">
                <input type="text" id="w1" placeholder="Wrong 1"><input type="text" id="w2" placeholder="Wrong 2"><input type="text" id="w3" placeholder="Wrong 3">
            </div>
            <textarea id="hint" placeholder="üí° Hint..."></textarea>
            <button onclick="addQuiz()" style="background: #27ae60;">Save to Cloud ‚òÅÔ∏è</button>
        </div>
    </div>

    <div class="column">
        <h1>üìä Mastery Tracker</h1>
        <div class="card">
            <div style="display:flex; gap:10px;">
                <select id="sort-by" onchange="loadScores()">
                    <option value="timestamp">Most Recent ‚è±Ô∏è</option>
                    <option value="score">Highest Score üèÜ</option>
                </select>
            </div>
            <table>
                <thead><tr><th>Student</th><th>Topic</th><th>Score</th><th>Rank</th></tr></thead>
                <tbody id="score-table"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, setDoc, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        window.addQuiz = async function() {
            const topic = document.getElementById('math-topic').value;
            const sc = document.getElementById('sub-concept').value;
            await setDoc(doc(db, "MathTopics", topic, "Quizzes", sc), {
                subConcept: sc,
                difficulty: document.getElementById('quiz-difficulty').value,
                question: document.getElementById('question').value,
                answer: document.getElementById('answer').value,
                wrongOptions: [document.getElementById('w1').value, document.getElementById('w2').value, document.getElementById('w3').value],
                hint: document.getElementById('hint').value
            });
            alert("Question Saved!");
        };

        window.loadScores = async function() {
            const table = document.getElementById('score-table');
            const snap = await getDocs(query(collection(db, "StudentScores"), orderBy(document.getElementById('sort-by').value, "desc")));
            let maxScores = {};
            let scoresData = [];
            snap.forEach(d => {
                let s = d.data();
                scoresData.push(s);
                let key = s.studentName + s.topic;
                if(!maxScores[key] || s.score > maxScores[key]) maxScores[key] = s.score;
            });
            table.innerHTML = "";
            scoresData.forEach(s => {
                let isTop = s.score === maxScores[s.studentName + s.topic];
                table.innerHTML += `<tr class="${isTop ? 'top-score' : ''}"><td>${isTop ? '‚≠ê ' : ''}${s.studentName}</td><td>${s.topic}</td><td>${s.score}</td><td>${s.rank}</td></tr>`;
            });
        };
        window.onload = loadScores;
    </script>
</body>
</html>